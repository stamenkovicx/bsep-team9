<div class="dashboard-container">
  <!-- NEULOGEVANI KORISNIK -->
  <div *ngIf="!isLoggedIn()" class="not-logged-in">
    <div class="welcome-message">
      <mat-icon class="welcome-icon">security</mat-icon>
      <h1>Welcome to PKI System</h1>
      <p>Please log in to manage your certificates and access all features</p>
      <button mat-raised-button color="primary" routerLink="/login" class="login-btn">
        <mat-icon>login</mat-icon>
        Login to Continue
      </button>
    </div>
  </div>

  <div *ngIf="isLoggedIn()">
    <div class="dashboard-header">
      <h1>PKI SYSTEM DASHBOARD</h1>
      <p>Manage your certificates and certificate authorities</p>
    </div>

    <!-- 2FA SEKCIJA -->
<mat-card style="margin: 20px 0;">
  <mat-card-header>
    <mat-card-title>üîê Two-Factor Authentication</mat-card-title>
  </mat-card-header>
  
  <mat-card-content>
    <!-- AKO NIJE ZAPOƒåET SETUP -->
    <div *ngIf="!showQRCode">
      <p>Add extra security to your account.</p>
      <button mat-raised-button color="accent" (click)="enable2FA()">
        Enable 2FA
      </button>
    </div>

    <!-- AKO JE ZAPOƒåET SETUP -->
    <div *ngIf="showQRCode">
      <h3>Step 1: Scan this QR code</h3>
      <img [src]="qrCodeUrl" alt="QR Code" style="max-width: 300px;">
      
      <h3>Step 2: Enter code from app</h3>
      <mat-form-field>
        <input matInput [(ngModel)]="verificationCode" placeholder="000000" maxlength="6">
      </mat-form-field>
      
      <div>
        <button mat-raised-button color="primary" (click)="verify2FACode()">
          Verify
        </button>
        <button mat-button (click)="cancel2FASetup()">
          Cancel
        </button>
      </div>
    </div>
  </mat-card-content>
</mat-card>

    <div class="quick-actions">
      <!-- ADMIN / CA -->
      <div *ngIf="isAdmin() || isCA()" class="action-card" routerLink="/certificates">
        <mat-icon class="action-icon">list_alt</mat-icon>
        <h3>{{ isAdmin() ? 'Cert List' : 'Chain View' }}</h3>
        <p>{{ isAdmin() ? 'View all certificates' : 'View certificate chain' }}</p>
      </div>

      <!-- SVI ULOGOVANI -->
      <div class="action-card" routerLink="/certificates/my-certificates">
        <mat-icon class="action-icon">folder_special</mat-icon>
        <h3>My Certs</h3>
        <p>View your certificates</p>
      </div>

      <!-- SAMO ADMIN / CA -->
      <div *ngIf="isAdmin() || isCA()" class="action-card" routerLink="/certificates/create">
        <mat-icon class="action-icon">add_circle</mat-icon>
        <h3>Create New</h3>
        <p>Issue new certificate</p>
      </div>
    </div>

    <div class="recent-certificates">
      <div class="section-header">
        <h2>Recent Certificates</h2>
        <button *ngIf="!isLoading && recentCertificates.length > 0" 
                mat-stroked-button 
                color="primary" 
                routerLink="/certificates"
                class="show-all-btn">
          Show All
        </button>
      </div>
      
      <div *ngIf="isLoading" class="loading">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading certificates...</p>
      </div>

      <div *ngIf="!isLoading && recentCertificates.length === 0" class="no-certificates">
        <mat-icon>info</mat-icon>
        <p>No certificates found. Create your first certificate!</p>
        <button mat-raised-button color="primary" routerLink="/certificates/create" class="create-first-btn">
          Create First Certificate
        </button>
      </div>

      <div class="certificate-list" *ngIf="!isLoading && recentCertificates.length > 0">
        <div class="certificate-item" *ngFor="let cert of recentCertificates">
          <mat-icon [class]="getStatusIcon(cert.status)">
            {{ getStatusIcon(cert.status) }}
          </mat-icon>
          <div class="certificate-info">
            <strong>{{ extractCommonName(cert.subject) }}</strong>
            <span class="cert-type">({{ cert.type }})</span>
          </div>
          <span class="cert-status" [class]="cert.status.toLowerCase()">
            {{ cert.status }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>